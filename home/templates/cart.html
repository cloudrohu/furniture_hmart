{% load static %}
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Your Cart | {{ setting.0.title }}</title>
  <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gray-50 text-gray-800">

  <!-- Header -->
  <header class="bg-white shadow p-4 flex justify-between items-center">
    <a href="/" class="flex items-center gap-2">
      <img src="{{ setting.0.logo.url }}" alt="Logo" class="h-10 w-auto">
      <span class="font-semibold text-lg">{{ setting.0.title }}</span>
    </a>
    <a href="/" class="text-teal-600 hover:underline text-sm">Continue Shopping</a>
  </header>

  <!-- Cart Container -->
  <section class="max-w-6xl mx-auto px-4 py-8">
    <h1 class="text-2xl font-semibold mb-6">Shopping Cart</h1>

    <!-- Cart Items Section -->
    <div id="cart-container" class="grid lg:grid-cols-3 gap-8">
      <div class="lg:col-span-2 bg-white shadow rounded-lg p-4" id="cart-items">
        <!-- Dynamic Cart Items will load here -->
        <p class="text-center text-gray-500 py-6">Your cart is empty.</p>
      </div>

      <!-- Summary Section -->
      <div class="bg-white shadow rounded-lg p-4 h-fit">
        <h2 class="text-lg font-semibold mb-4">Order Summary</h2>
        <div class="flex justify-between mb-2">
          <span>Subtotal</span>
          <span id="subtotal">₹0.00</span>
        </div>
        <div class="flex justify-between mb-2">
          <span>Delivery</span>
          <span class="text-green-600 font-medium">Free</span>
        </div>
        <div class="border-t pt-3 flex justify-between font-semibold text-lg">
          <span>Total</span>
          <span id="total">₹0.00</span>
        </div>
        <button class="w-full mt-4 py-3 bg-teal-700 hover:bg-teal-800 text-white rounded-lg font-semibold" id="checkout-btn">
          Proceed to Checkout
        </button>
      </div>
    </div>
  </section>

  <!-- JS: Basic Cart Logic (LocalStorage) -->
  <script>
    const cartContainer = document.getElementById('cart-items');
    const subtotalEl = document.getElementById('subtotal');
    const totalEl = document.getElementById('total');
    const checkoutBtn = document.getElementById('checkout-btn');

    function loadCart() {
      let cart = JSON.parse(localStorage.getItem('cart')) || [];
      if (cart.length === 0) {
        cartContainer.innerHTML = `<p class='text-center text-gray-500 py-6'>Your cart is empty.</p>`;
        subtotalEl.textContent = "₹0.00";
        totalEl.textContent = "₹0.00";
        return;
      }

      let html = "";
      let subtotal = 0;

      cart.forEach((item, index) => {
        const itemTotal = item.price * item.qty;
        subtotal += itemTotal;
        html += `
        <div class="flex items-center gap-4 border-b py-4">
          <img src="${item.image}" class="h-24 w-24 rounded object-cover border">
          <div class="flex-1">
            <h3 class="font-semibold text-lg">${item.name}</h3>
            <p class="text-gray-500 text-sm mb-2">Price: ₹${item.price}</p>
            <div class="flex items-center gap-2">
              <button onclick="updateQty(${index}, -1)" class="px-3 py-1 border rounded">-</button>
              <span>${item.qty}</span>
              <button onclick="updateQty(${index}, 1)" class="px-3 py-1 border rounded">+</button>
            </div>
          </div>
          <div class="text-right">
            <p class="font-semibold text-gray-700">₹${itemTotal.toFixed(2)}</p>
            <button onclick="removeItem(${index})" class="text-red-500 hover:underline text-sm mt-2">Remove</button>
          </div>
        </div>`;
      });

      cartContainer.innerHTML = html;
      subtotalEl.textContent = `₹${subtotal.toFixed(2)}`;
      totalEl.textContent = `₹${subtotal.toFixed(2)}`;
    }

    function updateQty(index, change) {
      let cart = JSON.parse(localStorage.getItem('cart')) || [];
      cart[index].qty += change;
      if (cart[index].qty <= 0) cart.splice(index, 1);
      localStorage.setItem('cart', JSON.stringify(cart));
      loadCart();
    }

    function removeItem(index) {
      let cart = JSON.parse(localStorage.getItem('cart')) || [];
      cart.splice(index, 1);
      localStorage.setItem('cart', JSON.stringify(cart));
      loadCart();
    }

    checkoutBtn.addEventListener('click', () => {
      alert('Redirecting to checkout...');
      // future: window.location.href = "{% url 'checkout' %}";
    });

    // Load cart initially
    loadCart();
  </script>

</body>
</html>

{% extends 'homebase.html' %}

{% block title %}{{ catdata.title }} Products{% endblock %}
{% block description %} {{ catdata.description }} {% endblock %}
{% block keywords %} {{ category.keywords }} {% endblock %}

{% block sidebar %} {% include 'sidebar.html' %} {% endblock %}
{% load humanize %}
{% block body %}

<!-- ðŸŒˆ Category Banner -->
<section class="relative mt-1.5 bg-gradient-to-r from-amber-50 via-white to-amber-100 py-12 mb-10 rounded-b-3xl shadow">
  <div class="max-w-7xl mx-auto text-center px-6">
    <h1 class="text-4xl md:text-5xl font-extrabold text-gray-800">
      {{ current_category.title }}
    </h1>
    <p class="text-gray-600 mt-3 text-lg">
      Explore our exclusive {{ current_category.title|lower }} collection designed for comfort and style.
    </p>
  </div>
</section>

<!-- ðŸŒŸ Main Wrapper -->
<main class="max-w-7xl mx-auto px-4 py-10 grid grid-cols-12 gap-8">

 <aside class="col-span-12 lg:col-span-3 space-y-6 fixed lg:static w-full lg:w-auto">
	<div class="rounded-2xl border bg-white p-6 shadow-md space-y-6">

	<!-- Header -->
	<h3 class="font-semibold text-xl flex items-center gap-2 text-gray-800">
		<i class="fa-solid fa-sliders text-amber-600"></i> Filters
	</h3>

	<!-- CATEGORY -->
	<div class="accordion border-b pb-3">
		<button class="w-full flex justify-betw een items-center font-semibold py-2 hover:text-amber-600 transition">
		<span><i class="fa-solid fa-couch text-amber-600 mr-2"></i> Category</span>
		<i class="fa-solid fa-chevron-down text-xs transition-transform duration-300"></i>
		</button>

		<div class="accordion-content max-h-0 overflow-hidden transition-all duration-300 mt-2">
		<form id="categoryForm" method="get" class="space-y-2 category-scroll max-h-64 overflow-y-auto pr-1 text-sm">
			{% for rs in category %}
			<label class="flex items-center gap-2 cursor-pointer hover:text-amber-600">
			<input type="checkbox" name="category" value="{{ rs.id }}" class="accent-amber-600 category-filter"
				{% if rs.id|stringformat:"s" in selected_categories %}checked{% endif %}>
			{{ rs.title }}
			</label>
			{% endfor %}
		</form>
		</div>
	</div>

	<!-- BRAND -->
	<div class="accordion border-b pb-3">
		<button class="w-full flex justify-between items-center font-semibold py-2 hover:text-amber-600 transition">
		<span><i class="fa-solid fa-tags text-amber-600 mr-2"></i> Brand</span>
		<i class="fa-solid fa-chevron-down text-xs transition-transform duration-300"></i>
		</button>
		<div class="accordion-content max-h-0 overflow-hidden transition-all duration-300 mt-2">
		<div class="category-scroll max-h-64 overflow-y-auto pr-1 space-y-2 text-sm">
			{% for br in brand %}
			<label class="flex items-center gap-2 cursor-pointer hover:text-amber-600">
			<input type="checkbox" name="brand" value="{{ br.id }}" class="accent-amber-600">
			{{ br.title }}
			</label>
			{% endfor %}
		</div>
		</div>
	</div>

	<!-- PRODUCT TYPE -->
	<div class="accordion border-b pb-3">
		<button class="w-full flex justify-between items-center font-semibold py-2 hover:text-amber-600 transition">
		<span><i class="fa-solid fa-star text-amber-600 mr-2"></i> Product Type</span>
		<i class="fa-solid fa-chevron-down text-xs transition-transform duration-300"></i>
		</button>
		<div class="accordion-content max-h-0 overflow-hidden transition-all duration-300 mt-2 text-sm space-y-2">
		<label class="flex items-center gap-2"><input type="radio" name="type" value="New Arrivals" class="accent-amber-600"> New Arrivals</label>
		<label class="flex items-center gap-2"><input type="radio" name="type" value="Top Rated" class="accent-amber-600"> Top Rated</label>
		<label class="flex items-center gap-2"><input type="radio" name="type" value="Featured" class="accent-amber-600"> Featured</label>
		</div>
	</div>

	<!-- AVAILABILITY -->
	<div class="accordion border-b pb-3">
		<button class="w-full flex justify-between items-center font-semibold py-2 hover:text-amber-600 transition">
		<span><i class="fa-solid fa-boxes-stacked text-amber-600 mr-2"></i> Availability</span>
		<i class="fa-solid fa-chevron-down text-xs transition-transform duration-300"></i>
		</button>
		<div class="accordion-content max-h-0 overflow-hidden transition-all duration-300 mt-2 text-sm space-y-2">
		<label class="flex items-center gap-2"><input type="checkbox" name="availability" value="In Stock" class="accent-amber-600"> In Stock</label>
		<label class="flex items-center gap-2"><input type="checkbox" name="availability" value="Limited Stock" class="accent-amber-600"> Limited Stock</label>
		<label class="flex items-center gap-2"><input type="checkbox" name="availability" value="Pre Order" class="accent-amber-600"> Pre Order</label>
		<label class="flex items-center gap-2"><input type="checkbox" name="availability" value="Out of Stock" class="accent-amber-600"> Out of Stock</label>
		</div>
	</div>

	<!-- COLOR -->
	<div class="accordion border-b pb-3">
		<button class="w-full flex justify-between items-center font-semibold py-2 hover:text-amber-600 transition">
		<span><i class="fa-solid fa-palette text-amber-600 mr-2"></i> Color</span>
		<i class="fa-solid fa-chevron-down text-xs transition-transform duration-300"></i>
		</button>
		<div class="accordion-content max-h-0 overflow-hidden transition-all duration-300 mt-2 text-sm space-y-2">
		<div class="flex flex-wrap gap-2">
			{% for rs in color %}
			<span class="w-6 h-6 rounded-full bg-black border cursor-pointer"></span>
			{% endfor %}
		</div>
		</div>
	</div>

	<!-- SIZE -->
	<div class="accordion border-b pb-3">
		<button class="w-full flex justify-between items-center font-semibold py-2 hover:text-amber-600 transition">
		<span><i class="fa-solid fa-ruler-combined text-amber-600 mr-2"></i> Size</span>
		<i class="fa-solid fa-chevron-down text-xs transition-transform duration-300"></i>
		</button>
		<div class="accordion-content max-h-0 overflow-hidden transition-all duration-300 mt-2 flex flex-wrap gap-2">
		<label class="px-3 py-1 border rounded cursor-pointer hover:bg-amber-50 text-sm">XS</label>
		<label class="px-3 py-1 border rounded cursor-pointer hover:bg-amber-50 text-sm">S</label>
		<label class="px-3 py-1 border rounded cursor-pointer hover:bg-amber-50 text-sm">M</label>
		<label class="px-3 py-1 border rounded cursor-pointer hover:bg-amber-50 text-sm">L</label>
		<label class="px-3 py-1 border rounded cursor-pointer hover:bg-amber-50 text-sm">XL</label>
		</div>
	</div>

	<!-- DISCOUNT -->
	<div class="accordion border-b pb-3">
		<button class="w-full flex justify-between items-center font-semibold py-2 hover:text-amber-600 transition">
		<span><i class="fa-solid fa-percent text-amber-600 mr-2"></i> Discount</span>
		<i class="fa-solid fa-chevron-down text-xs transition-transform duration-300"></i>
		</button>
		<div class="accordion-content max-h-0 overflow-hidden transition-all duration-300 mt-2 text-sm space-y-2">
		<label class="flex items-center gap-2"><input type="checkbox" class="accent-amber-600"> 10% or more</label>
		<label class="flex items-center gap-2"><input type="checkbox" class="accent-amber-600"> 20% or more</label>
		<label class="flex items-center gap-2"><input type="checkbox" class="accent-amber-600"> 30% or more</label>
		<label class="flex items-center gap-2"><input type="checkbox" class="accent-amber-600"> 50% or more</label>
		</div>
	</div>

	<!-- PRICE RANGE -->
	<div class="accordion border-b pb-3">
		<button class="w-full flex justify-between items-center font-semibold py-2 hover:text-amber-600 transition">
		<span><i class="fa-solid fa-indian-rupee-sign text-amber-600 mr-2"></i> Price Range</span>
		<i class="fa-solid fa-chevron-down text-xs transition-transform duration-300"></i>
		</button>
		<div class="accordion-content max-h-0 overflow-hidden transition-all duration-300 mt-3">
		<input id="priceRange" type="range" min="999" max="99999" value="24999" class="w-full accent-amber-600">
		<div class="text-xs mt-1 text-gray-500">Up to <span id="priceValue" class="font-medium text-gray-800">â‚¹24,999</span></div>
		</div>
	</div>

	<!-- RATING -->
	<div class="accordion border-b pb-3">
		<button class="w-full flex justify-between items-center font-semibold py-2 hover:text-amber-600 transition">
		<span><i class="fa-solid fa-star-half-stroke text-amber-600 mr-2"></i> Rating</span>
		<i class="fa-solid fa-chevron-down text-xs transition-transform duration-300"></i>
		</button>
		<div class="accordion-content max-h-0 overflow-hidden transition-all duration-300 mt-2 text-sm space-y-2">
		{% for i in "54321" %}
		<label class="flex items-center gap-1 cursor-pointer">
			<input type="radio" name="rating" value="{{ i }}" class="accent-amber-600">
			<span class="text-yellow-500">{% for j in i|make_list %}â˜…{% endfor %}</span>
			<span class="text-gray-500">& Up</span>
		</label>
		{% endfor %}
		</div>
	</div>

	<!-- SORT BY -->
	<div class="accordion border-b pb-3">
		<button class="w-full flex justify-between items-center font-semibold py-2 hover:text-amber-600 transition">
		<span><i class="fa-solid fa-arrow-up-wide-short text-amber-600 mr-2"></i> Sort By</span>
		<i class="fa-solid fa-chevron-down text-xs transition-transform duration-300"></i>
		</button>
		<div class="accordion-content max-h-0 overflow-hidden transition-all duration-300 mt-3">
		<select class="w-full border rounded px-3 py-2 text-sm focus:outline-none focus:ring-2 focus:ring-amber-600">
			<option>Relevance</option>
			<option>Price: Low to High</option>
			<option>Price: High to Low</option>
			<option>Newest First</option>
		</select>
		</div>
	</div>

	<!-- CLEAR BUTTON -->
	<button id="clearFilters" class="w-full mt-4 border border-amber-600 rounded-lg py-2 hover:bg-amber-600 hover:text-white font-medium text-amber-700 transition">
		<i class="fa-solid fa-rotate-right mr-1"></i> Clear All Filters
	</button>

	</div>
 </aside>

<!-- ========== Product Grid ========== -->
<section class="col-span-12 lg:col-span-9">
  <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-6">
    {% for rs in products %}
    <article
      class="group bg-white border border-gray-100 rounded-2xl overflow-hidden shadow hover:shadow-xl hover:-translate-y-1 transition-all duration-300 relative">

      <!-- ðŸ”¥ Discount Badge -->
      {% if rs.discount > 0 %}
      <span class="absolute top-3 left-3 bg-amber-600 text-white text-[11px] font-semibold px-2 py-1 rounded-full shadow">
        {{ rs.discount }}% OFF
      </span>
      {% endif %}

      <!-- ðŸ–¼ Image -->
      <a href="{% url 'product_detail' rs.id rs.slug %}">
        <div class="relative overflow-hidden">
          <img src="{{ rs.image.url }}" alt="{{ rs.title }}"
            class="w-full h-56 object-cover transform group-hover:scale-110 transition duration-500">
        </div>
      </a>

      <!-- ðŸ§¾ Content -->
      <div class="p-4">
        <a href="{% url 'product_detail' rs.id rs.slug %}">
          <h3 class="font-semibold text-gray-900 text-lg truncate group-hover:text-amber-600 transition">
            {{ rs.title }}
          </h3>
        </a>

        <!-- â­ Rating -->
        <div class="flex items-center text-yellow-500 text-xs mt-1">
          <i class="fa-solid fa-star"></i>
          <i class="fa-solid fa-star"></i>
          <i class="fa-solid fa-star"></i>
          <i class="fa-solid fa-star-half-stroke"></i>
          <i class="fa-regular fa-star text-gray-300"></i>
          <span class="ml-2 text-gray-500">(214 Reviews)</span>
        </div>

        <!-- ðŸ’° Price -->
        <div class="mt-2 flex items-center gap-2 text-sm">
          <span class="font-bold text-amber-700 text-lg">â‚¹{{ rs.get_final_price|intcomma }}</span>
          <span class="line-through text-gray-400 text-sm">â‚¹{{ rs.price|intcomma }}</span>
          <span class="text-amber-600 text-xs font-semibold">({{ rs.discount }}% off)</span>
        </div>

        <!-- ðŸ· Extra Details -->
        <div class="mt-3 text-sm text-gray-600 space-y-1">
          {% if rs.brand %}
          <p><i class="fa-solid fa-tags text-amber-600 mr-1"></i> <strong>Brand:</strong> {{ rs.brand }}</p>
          {% endif %}

          {% if rs.category %}
          <p><i class="fa-solid fa-couch text-amber-600 mr-1"></i> <strong>Category:</strong> {{ rs.category.title }}</p>
          {% endif %}

          {% if rs.availability %}
          <p><i class="fa-solid fa-box text-amber-600 mr-1"></i>
            <strong>Availability:</strong>
            {% if 'stock' in rs.availability|lower %}
              <span class="text-green-600">{{ rs.availability }}</span>
            {% else %}
              <span class="text-gray-600">{{ rs.availability }}</span>
            {% endif %}
          </p>
          {% endif %}
        </div>

        <!-- ðŸ›’ Buttons -->
        <div class="mt-4 flex items-center justify-between">
          <a href="{% url 'product_detail' rs.id rs.slug %}"
            class="flex-1 text-center bg-amber-600 text-white py-2 rounded-lg hover:bg-amber-700 transition text-sm font-medium">
            <i class="fa-solid fa-eye mr-1"></i> View Details
          </a>
          <button
            class="ml-3 flex-1 border border-amber-600 text-amber-700 py-2 rounded-lg hover:bg-amber-600 hover:text-white transition text-sm font-medium">
            <i class="fa-solid fa-cart-shopping mr-1"></i> Add to Cart
          </button>
        </div>
      </div>
    </article>
    {% empty %}
    <div class="col-span-3 text-center text-gray-500 py-10 text-lg">No products found in this category.</div>
    {% endfor %}
  </div>
</section>

</main>

<!-- ðŸŒ€ Pagination -->
<div class="flex justify-center mt-10 mb-6">
  <nav class="inline-flex items-center gap-2">
    {% if page_obj.has_previous %}
    <a href="?page={{ page_obj.previous_page_number }}" class="px-4 py-2 border rounded-full hover:bg-amber-100">â€¹</a>
    {% endif %}
    {% for num in page_obj.paginator.page_range %}
    {% if page_obj.number == num %}
    <span class="px-4 py-2 bg-amber-600 text-white rounded-full">{{ num }}</span>
    {% else %}
    <a href="?page={{ num }}" class="px-4 py-2 border rounded-full hover:bg-amber-100">{{ num }}</a>
    {% endif %}
    {% endfor %}
    {% if page_obj.has_next %}
    <a href="?page={{ page_obj.next_page_number }}" class="px-4 py-2 border rounded-full hover:bg-amber-100">â€º</a>
    {% endif %}
  </nav>
</div>

<script>
  // Filter accordion
  document.querySelectorAll('.accordion button').forEach(btn => {
    btn.addEventListener('click', () => {
      const acc = btn.parentElement;
      acc.classList.toggle('open');
      const icon = btn.querySelector('i.fa-chevron-down');
      icon.style.transform = acc.classList.contains('open') ? 'rotate(180deg)' : 'rotate(0deg)';
      const content = acc.querySelector('.accordion-content');
      content.style.maxHeight = acc.classList.contains('open') ? content.scrollHeight + 'px' : null;
    });
  });
  // Price slider
  const priceRange = document.getElementById('priceRange');
  const priceValue = document.getElementById('priceValue');
  priceRange.addEventListener('input', () => {
    priceValue.textContent = `â‚¹${Number(priceRange.value).toLocaleString()}`;
  });
</script>
{% endblock %}